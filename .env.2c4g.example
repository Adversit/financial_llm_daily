# 2核4G ECS 优化配置
# 目标：降低并发数和内存占用，确保系统稳定运行

# ========== 环境配置 ==========
ENV=production
TZ=Asia/Shanghai

# ========== 数据库配置 ==========
DATABASE_URL=postgresql://fin_user:YOUR_DB_PASSWORD@postgres:5432/fin_daily_report
POSTGRES_USER=fin_user
POSTGRES_PASSWORD=YOUR_DB_PASSWORD
POSTGRES_DB=fin_daily_report

# ========== Redis配置 ==========
REDIS_URL=redis://redis:6379/0

# ========== LLM Provider配置 ==========
# DeepSeek
PROVIDER_DEEPSEEK_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
PROVIDER_DEEPSEEK_BASE_URL=https://api.deepseek.com/v1
PROVIDER_DEEPSEEK_MODEL=deepseek-chat

# Qwen（优先使用，成本低）
PROVIDER_QWEN_API_KEY=sk-xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
PROVIDER_QWEN_BASE_URL=https://dashscope.aliyuncs.com/compatible-mode/v1
PROVIDER_QWEN_MODEL=qwen-plus

# ========== 邮件配置 ==========
SMTP_HOST=smtp.exmail.qq.com
SMTP_PORT=465
SMTP_USER=your-email@example.com
SMTP_PASS=your-smtp-password
SMTP_FROM=your-email@example.com

# ========== JWT配置 ==========
JWT_SECRET_KEY=请使用openssl_rand_-base64_32生成随机密钥
JWT_ALGORITHM=HS256
JWT_EXPIRE_DAYS=7

# ========== Playwright配置（2C4G优化）==========
PLAYWRIGHT_PROXY=  # 留空或填写代理地址
PLAYWRIGHT_MAX_BROWSERS=1  # ⚠️ 从3降至1（2C4G限制）
PLAYWRIGHT_HEADLESS=true
PLAYWRIGHT_TIMEOUT_MS=45000  # ⚠️ 从30s增至45s（避免超时）

# ========== 采集并发配置（2C4G优化）==========
# 关键优化：大幅降低并发数，减少内存占用
CRAWL_CONCURRENCY_RSS=3  # ⚠️ 从5降至3
CRAWL_CONCURRENCY_WEB=1  # 保持1
CRAWL_CONCURRENCY_DYNAMIC=1  # 保持1（Playwright并发）

# ========== LLM配置（2C4G优化）==========
LLM_TIMEOUT_SEC=120  # ⚠️ 从90s增至120s
LLM_RETRIES=2
LLM_CHUNK_BUDGET=0.7
LLM_CHUNK_OVERLAP_CHARS=200
LLM_MAX_CHUNKS_PER_ARTICLE=6  # ⚠️ 从8降至6（减少LLM调用）
LLM_LONGFORM_STRATEGY=summary_then_extract
LLM_ALLOW_PARALLEL_ARTICLE_PROCESSING=false  # 禁用并行处理

# ========== 报告配置 ==========
REPORT_TOPN=5
CONFIDENCE_THRESHOLD=0.6
MIN_CONTENT_LEN=120

# ========== 其他配置 ==========
MAIL_BATCH_LIMIT=50
MAIL_RATE_LIMIT_PER_SEC=0.5  # ⚠️ 从1.0降至0.5（降低发送速度）
MAIL_WINDOW_START=06:05
MAIL_WINDOW_END=06:30  # ⚠️ 从06:20延长至06:30（留更多时间）

# ========== 词云配置 ==========
WORDCLOUD_CACHE_TTL=86400
WORDCLOUD_MIN_KEYWORD_FREQ=2
WORDCLOUD_MAX_WORDS=50  # ⚠️ 从100降至50
WORDCLOUD_SIMILARITY_THRESHOLD=0.8
