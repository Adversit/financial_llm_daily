<mxfile host="app.diagrams.net" modified="2025-11-08T00:00:00.000Z" agent="Claude Code" version="24.0.0" type="device">
  <diagram name="第一阶段数据流程图 v1.2" id="dataflow">
    <mxGraphModel dx="1422" dy="794" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1600" pageHeight="2000" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />

        <!-- 标题 -->
        <mxCell id="title" value="金融情报日报系统 - 第一阶段数据流程图 (MVP)" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="400" y="20" width="800" height="40" as="geometry" />
        </mxCell>

        <!-- 时间轴标注 -->
        <mxCell id="timeline" value="时间轴 (Asia/Shanghai)" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="40" y="80" width="200" height="30" as="geometry" />
        </mxCell>

        <!-- 阶段1: 触发启动 (05:30) -->
        <mxCell id="phase1-box" value="阶段 1: 触发启动" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;fontStyle=1;fillColor=#e1d5e7;strokeColor=#9673a6;verticalAlign=top;align=left;" vertex="1" parent="1">
          <mxGeometry x="80" y="130" width="1440" height="140" as="geometry" />
        </mxCell>

        <mxCell id="time-0530" value="05:30" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="40" y="150" width="60" height="30" as="geometry" />
        </mxCell>

        <mxCell id="trigger-beat" value="Celery Beat&#xa;定时触发" style="shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;fontSize=11;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="120" y="170" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="task-dispatch" value="任务分发&#xa;Redis 队列" style="shape=parallelogram;perimeter=parallelogramPerimeter;whiteSpace=wrap;html=1;fixedSize=1;fontSize=11;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="280" y="170" width="140" height="60" as="geometry" />
        </mxCell>

        <mxCell id="crawl-tasks" value="采集任务队列&#xa;• crawl_rss&#xa;• crawl_static&#xa;• crawl_dynamic" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;" vertex="1" parent="1">
          <mxGeometry x="460" y="165" width="140" height="70" as="geometry" />
        </mxCell>

        <mxCell id="config-load" value="加载配置&#xa;sources 表&#xa;enabled=true" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="640" y="170" width="100" height="60" as="geometry" />
        </mxCell>

        <mxCell id="edge-trigger1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#e1d5e7;strokeColor=#9673a6;" edge="1" parent="1" source="trigger-beat" target="task-dispatch">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="edge-trigger2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#e1d5e7;strokeColor=#9673a6;" edge="1" parent="1" source="task-dispatch" target="crawl-tasks">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="edge-trigger3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryDz=0;strokeWidth=2;fillColor=#e1d5e7;strokeColor=#9673a6;" edge="1" parent="1" source="crawl-tasks" target="config-load">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- 阶段2: 信息采集 (05:30-05:35) -->
        <mxCell id="phase2-box" value="阶段 2: 信息源采集 (模块 A)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;fontStyle=1;fillColor=#e1d5e7;strokeColor=#9673a6;verticalAlign=top;align=left;" vertex="1" parent="1">
          <mxGeometry x="80" y="310" width="1440" height="320" as="geometry" />
        </mxCell>

        <mxCell id="time-0530-0535" value="05:30-&#xa;05:35" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="30" y="380" width="70" height="40" as="geometry" />
        </mxCell>

        <!-- RSS采集流 -->
        <mxCell id="rss-flow-box" value="RSS 采集流" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fontStyle=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;align=center;" vertex="1" parent="1">
          <mxGeometry x="120" y="350" width="400" height="120" as="geometry" />
        </mxCell>

        <mxCell id="rss-source" value="RSS Feed&#xa;(新智元/BigQuant&#xa;等≥30源)" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;fontSize=10;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="140" y="385" width="100" height="60" as="geometry" />
        </mxCell>

        <mxCell id="rss-parse" value="feedparser&#xa;解析&#xa;并发=10/Dev" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="260" y="390" width="90" height="50" as="geometry" />
        </mxCell>

        <mxCell id="rss-clean" value="去HTML&#xa;纯文本" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="370" y="390" width="70" height="50" as="geometry" />
        </mxCell>

        <mxCell id="rss-filter" value="24h过滤" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="460" y="390" width="50" height="50" as="geometry" />
        </mxCell>

        <mxCell id="rss-edge1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#fff2cc;strokeColor=#d6b656;" edge="1" parent="1" source="rss-source" target="rss-parse">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="rss-edge2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#fff2cc;strokeColor=#d6b656;" edge="1" parent="1" source="rss-parse" target="rss-clean">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="rss-edge3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#fff2cc;strokeColor=#d6b656;" edge="1" parent="1" source="rss-clean" target="rss-filter">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- 网站采集流 -->
        <mxCell id="web-flow-box" value="网站采集流" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fontStyle=1;fillColor=#fff2cc;strokeColor=#d6b656;verticalAlign=top;align=center;" vertex="1" parent="1">
          <mxGeometry x="120" y="490" width="500" height="120" as="geometry" />
        </mxCell>

        <mxCell id="web-source" value="网站源&#xa;(OpenAI/Google&#xa;Anthropic等)" style="shape=document;whiteSpace=wrap;html=1;boundedLbl=1;fontSize=10;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="140" y="525" width="100" height="60" as="geometry" />
        </mxCell>

        <mxCell id="web-static" value="静态抓取&#xa;requests&#xa;并发=2" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="260" y="530" width="80" height="50" as="geometry" />
        </mxCell>

        <mxCell id="web-dynamic" value="动态渲染&#xa;Playwright&#xa;超时25s" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="360" y="530" width="90" height="50" as="geometry" />
        </mxCell>

        <mxCell id="web-extract" value="正文抽取&#xa;trafilatura→&#xa;readability" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="470" y="530" width="90" height="50" as="geometry" />
        </mxCell>

        <mxCell id="web-filter" value="24h过滤" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="580" y="530" width="30" height="50" as="geometry" />
        </mxCell>

        <mxCell id="web-edge1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#fff2cc;strokeColor=#d6b656;" edge="1" parent="1" source="web-source" target="web-static">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="web-edge2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=1;fillColor=#ffe6cc;strokeColor=#d79b00;dashed=1;" edge="1" parent="1" source="web-static" target="web-dynamic">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="300" y="600" />
              <mxPoint x="405" y="600" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="web-edge2-label" value="失败回退" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;" vertex="1" connectable="0" parent="web-edge2">
          <mxGeometry x="-0.3" y="1" relative="1" as="geometry">
            <mxPoint x="15" y="-9" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="web-edge3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#fff2cc;strokeColor=#d6b656;" edge="1" parent="1" source="web-static" target="web-extract">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="web-edge4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#fff2cc;strokeColor=#d6b656;" edge="1" parent="1" source="web-dynamic" target="web-extract">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="web-edge5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#fff2cc;strokeColor=#d6b656;" edge="1" parent="1" source="web-extract" target="web-filter">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- 去重与落库 -->
        <mxCell id="dedup-flow-box" value="去重与落库" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fontStyle=1;fillColor=#dae8fc;strokeColor=#6c8ebf;verticalAlign=top;align=center;" vertex="1" parent="1">
          <mxGeometry x="680" y="350" width="420" height="260" as="geometry" />
        </mxCell>

        <mxCell id="dedup-merge" value="合并输入" style="shape=trapezoid;perimeter=trapezoidPerimeter;whiteSpace=wrap;html=1;fixedSize=1;fontSize=10;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="700" y="385" width="80" height="40" as="geometry" />
        </mxCell>

        <mxCell id="dedup-url" value="一级去重&#xa;canonical_url&#xa;标准化URL+&#xa;标题+时间" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="810" y="380" width="90" height="60" as="geometry" />
        </mxCell>

        <mxCell id="dedup-simhash" value="二级去重&#xa;SimHash&#xa;汉明距≤3" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="930" y="380" width="90" height="60" as="geometry" />
        </mxCell>

        <mxCell id="dedup-decision" value="保留策略&#xa;时间更早/&#xa;来源权威" style="rhombus;whiteSpace=wrap;html=1;fontSize=9;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="1040" y="375" width="80" height="70" as="geometry" />
        </mxCell>

        <mxCell id="db-write-articles" value="写入 articles 表&#xa;• source_id&#xa;• title, url, content_text&#xa;• published_at, fetched_at&#xa;• simhash, canonical_url&#xa;• processing_status=raw" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fontSize=9;fillColor=#f8cecc;strokeColor=#b85450;align=left;" vertex="1" parent="1">
          <mxGeometry x="720" y="470" width="160" height="100" as="geometry" />
        </mxCell>

        <mxCell id="db-write-queue" value="写入 extraction_queue&#xa;• article_id&#xa;• status=queued&#xa;• priority=0&#xa;• attempts=0" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fontSize=9;fillColor=#f8cecc;strokeColor=#b85450;align=left;" vertex="1" parent="1">
          <mxGeometry x="920" y="470" width="160" height="100" as="geometry" />
        </mxCell>

        <mxCell id="dedup-edge1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#dae8fc;strokeColor=#6c8ebf;" edge="1" parent="1" source="rss-filter" target="dedup-merge">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="660" y="415" />
              <mxPoint x="660" y="405" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="dedup-edge2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#dae8fc;strokeColor=#6c8ebf;" edge="1" parent="1" source="web-filter" target="dedup-merge">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="660" y="555" />
              <mxPoint x="660" y="405" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="dedup-edge3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#dae8fc;strokeColor=#6c8ebf;" edge="1" parent="1" source="dedup-merge" target="dedup-url">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="dedup-edge4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#dae8fc;strokeColor=#6c8ebf;" edge="1" parent="1" source="dedup-url" target="dedup-simhash">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="dedup-edge5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#dae8fc;strokeColor=#6c8ebf;" edge="1" parent="1" source="dedup-simhash" target="dedup-decision">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="dedup-edge6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryDz=0;strokeWidth=2;fillColor=#dae8fc;strokeColor=#6c8ebf;" edge="1" parent="1" source="dedup-decision" target="db-write-articles">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1080" y="460" />
              <mxPoint x="800" y="460" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="dedup-edge6-label" value="保留" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;" vertex="1" connectable="0" parent="dedup-edge6">
          <mxGeometry x="-0.3" y="1" relative="1" as="geometry">
            <mxPoint x="80" y="-7" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="dedup-edge7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryDz=0;strokeWidth=2;fillColor=#dae8fc;strokeColor=#6c8ebf;" edge="1" parent="1" source="dedup-decision" target="db-write-queue">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- 阶段3: LLM 抽取 (05:35-05:40) -->
        <mxCell id="phase3-box" value="阶段 3: 信息处理 - LLM 抽取 (模块 B)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;fontStyle=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;align=left;" vertex="1" parent="1">
          <mxGeometry x="80" y="670" width="1440" height="380" as="geometry" />
        </mxCell>

        <mxCell id="time-0535-0540" value="05:35-&#xa;05:40" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="30" y="770" width="70" height="40" as="geometry" />
        </mxCell>

        <mxCell id="llm-queue-read" value="读取 extraction_queue&#xa;status=queued&#xa;ORDER BY priority DESC" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fontSize=10;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="120" y="715" width="140" height="70" as="geometry" />
        </mxCell>

        <mxCell id="llm-article-read" value="读取 articles&#xa;获取 content_text" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fontSize=10;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="120" y="810" width="140" height="60" as="geometry" />
        </mxCell>

        <mxCell id="llm-chunk" value="分块引擎&#xa;• 语义切分(段落+句子)&#xa;• 预算70%上限&#xa;• 重叠200字符&#xa;• 最多8段/文" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;align=left;" vertex="1" parent="1">
          <mxGeometry x="300" y="715" width="140" height="90" as="geometry" />
        </mxCell>

        <mxCell id="llm-check-long" value="过长?" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="330" y="825" width="80" height="60" as="geometry" />
        </mxCell>

        <mxCell id="llm-degrade" value="降级策略&#xa;summary_then_extract&#xa;或 headN_plus_overall" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="310" y="910" width="120" height="50" as="geometry" />
        </mxCell>

        <mxCell id="llm-provider" value="Provider 路由&#xa;DeepSeek Chat (主)&#xa;↓ 失败/超时90s&#xa;Qwen Max/Plus (备)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;align=left;" vertex="1" parent="1">
          <mxGeometry x="480" y="715" width="140" height="90" as="geometry" />
        </mxCell>

        <mxCell id="llm-call-loop" value="逐段调用 (或并行)&#xa;• 重试2次&#xa;• 超时90s/段&#xa;• 返回 JSON Schema" style="shape=hexagon;perimeter=hexagonPerimeter2;whiteSpace=wrap;html=1;fixedSize=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;align=left;" vertex="1" parent="1">
          <mxGeometry x="660" y="715" width="160" height="80" as="geometry" />
        </mxCell>

        <mxCell id="llm-parse" value="解析 JSON&#xa;fact / opinion&#xa;region / layer&#xa;confidence" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;align=left;" vertex="1" parent="1">
          <mxGeometry x="860" y="715" width="110" height="80" as="geometry" />
        </mxCell>

        <mxCell id="llm-merge" value="合并去重&#xa;• 事实归一化&#xa;• SimHash去重&#xa;• 编辑距≤2&#xa;• 置信度聚合" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;align=left;" vertex="1" parent="1">
          <mxGeometry x="1010" y="715" width="120" height="90" as="geometry" />
        </mxCell>

        <mxCell id="llm-status" value="文章级状态&#xa;ok / partial / failed" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="1170" y="720" width="100" height="80" as="geometry" />
        </mxCell>

        <mxCell id="db-write-items" value="写入 extraction_items&#xa;• article_id&#xa;• fact, opinion&#xa;• region, layer&#xa;• evidence_span&#xa;• confidence&#xa;• created_at" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fontSize=9;fillColor=#f8cecc;strokeColor=#b85450;align=left;" vertex="1" parent="1">
          <mxGeometry x="1320" y="705" width="140" height="110" as="geometry" />
        </mxCell>

        <mxCell id="db-update-queue" value="更新 extraction_queue&#xa;status=done/failed&#xa;last_error" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fontSize=9;fillColor=#f8cecc;strokeColor=#b85450;align=left;" vertex="1" parent="1">
          <mxGeometry x="1150" y="840" width="140" height="70" as="geometry" />
        </mxCell>

        <mxCell id="db-update-article" value="更新 articles&#xa;processing_status=&#xa;done/failed" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fontSize=9;fillColor=#f8cecc;strokeColor=#b85450;align=left;" vertex="1" parent="1">
          <mxGeometry x="1320" y="840" width="140" height="70" as="geometry" />
        </mxCell>

        <mxCell id="db-usage-log" value="记录 provider_usage&#xa;• provider, model&#xa;• prompt_tokens&#xa;• completion_tokens&#xa;• total_cost" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fontSize=9;fillColor=#f8cecc;strokeColor=#b85450;align=left;" vertex="1" parent="1">
          <mxGeometry x="1150" y="940" width="140" height="90" as="geometry" />
        </mxCell>

        <mxCell id="llm-edge1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;exitDz=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1" source="llm-queue-read" target="llm-chunk">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="llm-edge2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;exitDz=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1" source="llm-article-read" target="llm-chunk">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="llm-edge3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1" source="llm-chunk" target="llm-check-long">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="llm-edge4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" edge="1" parent="1" source="llm-check-long" target="llm-degrade">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="llm-edge4-label" value="&gt;8段" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;" vertex="1" connectable="0" parent="llm-edge4">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint x="15" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="llm-edge5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1" source="llm-check-long" target="llm-provider">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="450" y="855" />
              <mxPoint x="450" y="760" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="llm-edge5-label" value="≤8段" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;" vertex="1" connectable="0" parent="llm-edge5">
          <mxGeometry x="-0.3" y="1" relative="1" as="geometry">
            <mxPoint x="-5" y="-9" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="llm-edge6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" edge="1" parent="1" source="llm-degrade" target="llm-provider">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="450" y="935" />
              <mxPoint x="450" y="760" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="llm-edge7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1" source="llm-provider" target="llm-call-loop">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="llm-edge8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1" source="llm-call-loop" target="llm-parse">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="llm-edge9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1" source="llm-parse" target="llm-merge">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="llm-edge10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1" source="llm-merge" target="llm-status">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="llm-edge11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryDz=0;strokeWidth=2;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1" source="llm-status" target="db-write-items">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="llm-edge12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryDz=0;strokeWidth=1;fillColor=#d5e8d4;strokeColor=#82b366;dashed=1;" edge="1" parent="1" source="llm-status" target="db-update-queue">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="llm-edge13" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;exitDz=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;entryDz=0;strokeWidth=1;fillColor=#d5e8d4;strokeColor=#82b366;dashed=1;" edge="1" parent="1" source="db-write-items" target="db-update-article">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="llm-edge14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;exitDz=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;entryDz=0;strokeWidth=1;fillColor=#d5e8d4;strokeColor=#82b366;dashed=1;" edge="1" parent="1" source="db-update-queue" target="db-usage-log">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1220" y="920" />
              <mxPoint x="1310" y="920" />
              <mxPoint x="1310" y="985" />
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- 阶段4: 报告生成 (05:40-05:42) -->
        <mxCell id="phase4-box" value="阶段 4: 报告生成 (模块 C)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;fontStyle=1;fillColor=#ffe6cc;strokeColor=#d79b00;verticalAlign=top;align=left;" vertex="1" parent="1">
          <mxGeometry x="80" y="1090" width="1440" height="320" as="geometry" />
        </mxCell>

        <mxCell id="time-0540-0542" value="05:40-&#xa;05:42" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="30" y="1180" width="70" height="40" as="geometry" />
        </mxCell>

        <mxCell id="report-read-items" value="读取 extraction_items&#xa;当日所有事实观点" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fontSize=10;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="120" y="1140" width="140" height="70" as="geometry" />
        </mxCell>

        <mxCell id="report-filter" value="过滤筛选&#xa;• confidence≥0.6&#xa;• content_len≥120字&#xa;• 去水文章" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;align=left;" vertex="1" parent="1">
          <mxGeometry x="300" y="1140" width="120" height="70" as="geometry" />
        </mxCell>

        <mxCell id="report-section" value="分区分组&#xa;国内/国外 ×&#xa;(政治/经济/&#xa;金融大模型技术/&#xa;金融科技)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;align=left;" vertex="1" parent="1">
          <mxGeometry x="460" y="1135" width="110" height="80" as="geometry" />
        </mxCell>

        <mxCell id="report-score" value="评分排序&#xa;score=&#xa;0.5*影响力+&#xa;0.3*新近度+&#xa;0.2*权威" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;fillColor=#fff2cc;strokeColor=#d6b656;align=left;" vertex="1" parent="1">
          <mxGeometry x="610" y="1135" width="100" height="80" as="geometry" />
        </mxCell>

        <mxCell id="report-topn" value="TopN 筛选&#xa;每区 Top5" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="750" y="1145" width="90" height="60" as="geometry" />
        </mxCell>

        <!-- 正文生成 -->
        <mxCell id="report-body-box" value="正文 HTML" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fontStyle=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;align=center;" vertex="1" parent="1">
          <mxGeometry x="880" y="1130" width="260" height="120" as="geometry" />
        </mxCell>

        <mxCell id="report-body-header" value="抬头: 项目名+日期" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="900" y="1160" width="100" height="30" as="geometry" />
        </mxCell>

        <mxCell id="report-body-toc" value="目录锚点" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="1020" y="1160" width="100" height="30" as="geometry" />
        </mxCell>

        <mxCell id="report-body-cards" value="分区卡片 (TopN)&#xa;标题链接+摘要+标签" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="900" y="1205" width="220" height="35" as="geometry" />
        </mxCell>

        <!-- 附件生成 -->
        <mxCell id="report-attach-box" value="附件 HTML" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11;fontStyle=1;fillColor=#d5e8d4;strokeColor=#82b366;verticalAlign=top;align=center;" vertex="1" parent="1">
          <mxGeometry x="1180" y="1130" width="260" height="120" as="geometry" />
        </mxCell>

        <mxCell id="report-attach-full" value="全量事实观点&#xa;(不限TopN)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="1200" y="1160" width="100" height="30" as="geometry" />
        </mxCell>

        <mxCell id="report-attach-link" value="原文链接可点" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="1320" y="1160" width="100" height="30" as="geometry" />
        </mxCell>

        <mxCell id="report-attach-sort" value="按来源/时间排序" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;fillColor=#f5f5f5;strokeColor=#666666;" vertex="1" parent="1">
          <mxGeometry x="1200" y="1205" width="220" height="35" as="geometry" />
        </mxCell>

        <!-- 模板渲染与落库 -->
        <mxCell id="report-template" value="Jinja2 模板渲染&#xa;HTML生成" style="shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;fontSize=10;fillColor=#dae8fc;strokeColor=#6c8ebf;" vertex="1" parent="1">
          <mxGeometry x="920" y="1280" width="160" height="50" as="geometry" />
        </mxCell>

        <mxCell id="report-meta" value="生成元数据&#xa;sections_json&#xa;build_meta, build_ms" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;fillColor=#fff2cc;strokeColor=#d6b656;align=left;" vertex="1" parent="1">
          <mxGeometry x="1120" y="1280" width="130" height="50" as="geometry" />
        </mxCell>

        <mxCell id="db-write-reports" value="写入 reports 表&#xa;• report_date&#xa;• html_body (正文)&#xa;• html_attachment (附件)&#xa;• sections_json&#xa;• build_meta, build_ms&#xa;• created_at" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fontSize=9;fillColor=#f8cecc;strokeColor=#b85450;align=left;" vertex="1" parent="1">
          <mxGeometry x="1290" y="1270" width="160" height="110" as="geometry" />
        </mxCell>

        <mxCell id="report-edge1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;exitDz=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" edge="1" parent="1" source="report-read-items" target="report-filter">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="report-edge2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" edge="1" parent="1" source="report-filter" target="report-section">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="report-edge3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" edge="1" parent="1" source="report-section" target="report-score">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="report-edge4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" edge="1" parent="1" source="report-score" target="report-topn">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="report-edge5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" edge="1" parent="1" source="report-topn" target="report-body-box">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="report-edge5-label" value="正文" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;" vertex="1" connectable="0" parent="report-edge5">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint y="-9" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="report-edge6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=0;exitDx=0;exitDy=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" edge="1" parent="1" source="report-attach-box" target="report-filter">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1310" y="1100" />
              <mxPoint x="360" y="1100" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="report-edge6-label" value="全量(跳过TopN)" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;" vertex="1" connectable="0" parent="report-edge6">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint x="215" y="-9" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="report-edge7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.25;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" edge="1" parent="1" source="report-body-box" target="report-template">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="report-edge8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.75;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" edge="1" parent="1" source="report-attach-box" target="report-template">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1310" y="1260" />
              <mxPoint x="1040" y="1260" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="report-edge9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" edge="1" parent="1" source="report-template" target="report-meta">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="report-edge10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryDz=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" edge="1" parent="1" source="report-meta" target="db-write-reports">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- 阶段5: 邮件投递 (05:42-05:50) -->
        <mxCell id="phase5-box" value="阶段 5: 邮件投递 (模块 D)" style="rounded=1;whiteSpace=wrap;html=1;fontSize=14;fontStyle=1;fillColor=#f8cecc;strokeColor=#b85450;verticalAlign=top;align=left;" vertex="1" parent="1">
          <mxGeometry x="80" y="1450" width="1440" height="300" as="geometry" />
        </mxCell>

        <mxCell id="time-0542-0550" value="05:42-&#xa;05:50" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1;fontColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="30" y="1550" width="70" height="40" as="geometry" />
        </mxCell>

        <mxCell id="mail-read-report" value="读取 reports&#xa;当日报告" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fontSize=10;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="120" y="1500" width="120" height="60" as="geometry" />
        </mxCell>

        <mxCell id="mail-read-recipients" value="读取 report_recipients&#xa;type=recipient&#xa;enabled=true" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fontSize=10;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="120" y="1590" width="140" height="70" as="geometry" />
        </mxCell>

        <mxCell id="mail-compose" value="组装邮件&#xa;• 主题: 金融情报日报-YYYY-MM-DD&#xa;• 正文: html_body&#xa;• 附件: daily-report-YYYY-MM-DD.html" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;fillColor=#fff2cc;strokeColor=#d6b656;align=left;" vertex="1" parent="1">
          <mxGeometry x="300" y="1505" width="230" height="70" as="geometry" />
        </mxCell>

        <mxCell id="mail-batch" value="分批处理&#xa;最多50人/封&#xa;To + BCC" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;align=left;" vertex="1" parent="1">
          <mxGeometry x="580" y="1505" width="110" height="60" as="geometry" />
        </mxCell>

        <mxCell id="mail-throttle" value="节流控制&#xa;1封/秒" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#fff2cc;strokeColor=#d6b656;" vertex="1" parent="1">
          <mxGeometry x="730" y="1510" width="90" height="50" as="geometry" />
        </mxCell>

        <mxCell id="mail-smtp" value="SMTP 发送&#xa;网易 SSL 465&#xa;授权码登录&#xa;UTF-8编码" style="shape=process;whiteSpace=wrap;html=1;backgroundOutline=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;align=left;" vertex="1" parent="1">
          <mxGeometry x="860" y="1500" width="130" height="70" as="geometry" />
        </mxCell>

        <mxCell id="mail-status" value="发送状态?" style="rhombus;whiteSpace=wrap;html=1;fontSize=10;fillColor=#e1d5e7;strokeColor=#9673a6;" vertex="1" parent="1">
          <mxGeometry x="1030" y="1505" width="90" height="60" as="geometry" />
        </mxCell>

        <mxCell id="mail-retry" value="失败重试&#xa;最多2次&#xa;退避延迟" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="1">
          <mxGeometry x="1020" y="1595" width="110" height="55" as="geometry" />
        </mxCell>

        <mxCell id="mail-blacklist" value="硬退信处理&#xa;(用户不存在)&#xa;加入黑名单" style="rounded=1;whiteSpace=wrap;html=1;fontSize=9;fillColor=#f8cecc;strokeColor=#b85450;" vertex="1" parent="1">
          <mxGeometry x="1020" y="1675" width="110" height="55" as="geometry" />
        </mxCell>

        <mxCell id="db-write-delivery" value="写入 delivery_log&#xa;• report_id, batch_no&#xa;• recipients_snapshot&#xa;• message_id&#xa;• status (ok/failed/partial)&#xa;• error_code, error_message&#xa;• sent_at, duration_ms" style="shape=cylinder3;whiteSpace=wrap;html=1;boundedLbl=1;backgroundOutline=1;size=15;fontSize=9;fillColor=#f8cecc;strokeColor=#b85450;align=left;" vertex="1" parent="1">
          <mxGeometry x="1180" y="1490" width="180" height="120" as="geometry" />
        </mxCell>

        <mxCell id="mail-window-check" value="窗口检查&#xa;05:35-05:50" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="1395" y="1510" width="100" height="50" as="geometry" />
        </mxCell>

        <mxCell id="mail-edge1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;exitDz=0;entryX=0;entryY=0.25;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#f8cecc;strokeColor=#b85450;" edge="1" parent="1" source="mail-read-report" target="mail-compose">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="mail-edge2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;exitDz=0;entryX=0;entryY=0.75;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#f8cecc;strokeColor=#b85450;" edge="1" parent="1" source="mail-read-recipients" target="mail-compose">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="mail-edge3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#f8cecc;strokeColor=#b85450;" edge="1" parent="1" source="mail-compose" target="mail-batch">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="mail-edge4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#f8cecc;strokeColor=#b85450;" edge="1" parent="1" source="mail-batch" target="mail-throttle">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="mail-edge5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#f8cecc;strokeColor=#b85450;" edge="1" parent="1" source="mail-throttle" target="mail-smtp">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="mail-edge6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#f8cecc;strokeColor=#b85450;" edge="1" parent="1" source="mail-smtp" target="mail-status">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <mxCell id="mail-edge7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=2;fillColor=#ffe6cc;strokeColor=#d79b00;" edge="1" parent="1" source="mail-status" target="mail-retry">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="mail-edge7-label" value="失败" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;" vertex="1" connectable="0" parent="mail-edge7">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint x="15" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="mail-edge8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0;exitY=0.5;exitDx=0;exitDy=0;entryX=1;entryY=0.5;entryDx=0;entryDy=0;strokeWidth=1;fillColor=#ffe6cc;strokeColor=#d79b00;dashed=1;" edge="1" parent="1" source="mail-retry" target="mail-smtp">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1000" y="1623" />
              <mxPoint x="1000" y="1535" />
            </Array>
          </mxGeometry>
        </mxCell>

        <mxCell id="mail-edge9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=1;fillColor=#f8cecc;strokeColor=#b85450;dashed=1;" edge="1" parent="1" source="mail-retry" target="mail-blacklist">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="mail-edge9-label" value="硬退信" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;" vertex="1" connectable="0" parent="mail-edge9">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint x="20" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="mail-edge10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;entryX=0;entryY=0.5;entryDx=0;entryDy=0;entryDz=0;strokeWidth=2;fillColor=#f8cecc;strokeColor=#b85450;" edge="1" parent="1" source="mail-status" target="db-write-delivery">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="mail-edge10-label" value="记录" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=9;" vertex="1" connectable="0" parent="mail-edge10">
          <mxGeometry x="-0.2" y="1" relative="1" as="geometry">
            <mxPoint y="-9" as="offset" />
          </mxGeometry>
        </mxCell>

        <mxCell id="mail-edge11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;exitDz=0;entryX=0.5;entryY=1;entryDx=0;entryDy=0;strokeWidth=1;fillColor=#f8cecc;strokeColor=#b85450;dashed=1;" edge="1" parent="1" source="db-write-delivery" target="mail-window-check">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>

        <!-- 完成标识 -->
        <mxCell id="completion" value="✓ 第一阶段完成" style="rounded=1;whiteSpace=wrap;html=1;fontSize=16;fontStyle=1;fillColor=#d5e8d4;strokeColor=#82b366;" vertex="1" parent="1">
          <mxGeometry x="620" y="1800" width="360" height="60" as="geometry" />
        </mxCell>

        <mxCell id="completion-desc" value="验收标准: articles≥10, extraction_items≥20, reports=1, delivery_log≥1&#xa;时效目标: 05:30启动 → 05:50前完成邮件发送&#xa;CLI测试: run_once --step all 一次跑通" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="500" y="1880" width="600" height="60" as="geometry" />
        </mxCell>

        <mxCell id="final-edge" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=0.5;exitY=1;exitDx=0;exitDy=0;entryX=0.5;entryY=0;entryDx=0;entryDy=0;strokeWidth=3;fillColor=#d5e8d4;strokeColor=#82b366;" edge="1" parent="1" source="mail-window-check" target="completion">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1445" y="1780" />
              <mxPoint x="800" y="1780" />
            </Array>
          </mxGeometry>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
