{% extends "base.html" %}

{% block breadcrumb %}åå¥½è®¾ç½®{% endblock %}

{% block content %}
<style>
    /* åå¥½è®¾ç½®é¡µé¢ä¸“ç”¨æ ·å¼ */
    .preferences-header {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        border-radius: 12px;
        padding: 2rem;
        color: white;
        margin-bottom: 2rem;
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.2);
    }

    .preferences-title {
        font-size: 1.75rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .preferences-subtitle {
        font-size: 0.9375rem;
        opacity: 0.95;
    }

    .pref-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
        gap: 2rem;
    }

    .pref-card {
        background: white;
        border-radius: 12px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        overflow: hidden;
    }

    .pref-card-header {
        padding: 1.5rem;
        background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
        border-bottom: 1px solid #e2e8f0;
    }

    .pref-card-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: #0f172a;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .pref-card-body {
        padding: 1.5rem;
    }

    .template-item {
        padding: 1.25rem;
        background: #f8fafc;
        border-radius: 10px;
        border: 1px solid #e2e8f0;
        transition: all 0.2s;
    }

    .template-item:hover {
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        border-color: #cbd5e1;
    }

    .template-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.75rem;
    }

    .template-name {
        font-weight: 600;
        color: #0f172a;
        font-size: 1rem;
    }

    .template-content-box {
        padding: 1rem;
        background: white;
        border-radius: 8px;
        border: 1px solid #e2e8f0;
        margin-bottom: 0.75rem;
        max-height: 140px;
        overflow-y: auto;
    }

    .template-text {
        white-space: pre-wrap;
        font-size: 0.875rem;
        color: #475569;
        line-height: 1.6;
    }

    .template-footer {
        display: flex;
        justify-content: space-between;
        align-items: center;
        font-size: 0.8125rem;
        color: #64748b;
    }

    .help-box {
        background: white;
        border-radius: 12px;
        padding: 1.5rem;
        margin-top: 2rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        border-left: 4px solid #2563eb;
    }

    .help-title {
        font-weight: 600;
        color: #0f172a;
        margin-bottom: 0.75rem;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .help-list {
        margin: 0;
        padding-left: 1.25rem;
        color: #475569;
        font-size: 0.875rem;
    }

    .help-list li {
        margin: 0.5rem 0;
        line-height: 1.6;
    }

    .empty-state-pref {
        text-align: center;
        padding: 3rem 1rem;
    }

    .empty-icon-pref {
        width: 80px;
        height: 80px;
        margin: 0 auto 1.5rem;
        background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2.5rem;
    }

    .empty-title-pref {
        font-size: 1.125rem;
        font-weight: 600;
        color: #0f172a;
        margin-bottom: 0.5rem;
    }

    .empty-desc-pref {
        font-size: 0.875rem;
        color: #64748b;
    }

    @media (max-width: 1024px) {
        .pref-grid {
            grid-template-columns: 1fr;
        }
    }
</style>

<!-- é¡µé¢å¤´éƒ¨ -->
<div class="preferences-header">
    <div class="preferences-title">âš™ï¸ æç¤ºè¯æ¨¡æ¿ç®¡ç†</div>
    <div class="preferences-subtitle">åˆ›å»ºå’Œç®¡ç†æ‚¨çš„ä¸ªæ€§åŒ–æç¤ºè¯æ¨¡æ¿ï¼ˆæœ€å¤š {{ max_templates }} æ¡ï¼‰</div>
</div>

<!-- é”™è¯¯æç¤º -->
{% if error %}
<div style="background: #fee; border-left: 4px solid #f44; padding: 1rem 1.25rem; border-radius: 8px; margin-bottom: 1.5rem; color: #c00;">
    <strong>é”™è¯¯ï¼š</strong>{{ error }}
</div>
{% endif %}

<!-- åŒåˆ—å¸ƒå±€ -->
<div class="pref-grid">
    <!-- å·¦ä¾§ï¼šåˆ›å»ºè¡¨å• -->
    <div class="pref-card">
        <div class="pref-card-header">
            <h2 class="pref-card-title">
                <span>âœï¸</span>
                <span>æ–°å»º/æ›´æ–°æ¨¡æ¿</span>
            </h2>
        </div>
        <div class="pref-card-body">
            <form method="post">
                <div class="form-group">
                    <label class="form-label">ğŸ“ æ¨¡æ¿åç§°</label>
                    <input
                        type="text"
                        name="name"
                        required
                        class="form-control"
                        placeholder="ä¾‹å¦‚ï¼šæŠ€æœ¯åˆ†ææ¨¡æ¿"
                        maxlength="100"
                    >
                    <div class="form-text">ä¸ºæ¨¡æ¿èµ·ä¸€ä¸ªå®¹æ˜“è¯†åˆ«çš„åç§°</div>
                </div>

                <div class="form-group">
                    <label class="form-label">ğŸ¯ ä½œç”¨èŒƒå›´</label>
                    <select name="scope" class="form-control">
                        <option value="daily">Daily - æ—¥æŠ¥çº§åˆ«</option>
                        <option value="article">Article - æ–‡ç« çº§åˆ«</option>
                    </select>
                    <div class="form-text">é€‰æ‹©æ¨¡æ¿åº”ç”¨çš„èŒƒå›´</div>
                </div>

                <div class="form-group">
                    <label class="form-label">ğŸ’¬ æç¤ºè¯å†…å®¹</label>
                    <textarea
                        name="prompt_text"
                        rows="6"
                        class="form-control"
                        maxlength="2000"
                        placeholder="è¾“å…¥æ‚¨çš„æç¤ºè¯å†…å®¹ï¼ˆæœ€å¤š 2000 å­—ç¬¦ï¼‰"
                        style="resize: vertical; min-height: 120px;"
                    ></textarea>
                    <div class="form-text">æ”¯æŒå¤šè¡Œæ–‡æœ¬ï¼Œæœ€å¤š 2000 å­—ç¬¦</div>
                </div>

                <div class="form-group">
                    <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                        <input
                            type="checkbox"
                            name="is_default"
                            value="1"
                            style="width: 1rem; height: 1rem; cursor: pointer;"
                        >
                        <span class="form-label" style="margin: 0;">â­ è®¾ä¸ºé»˜è®¤æ¨¡æ¿</span>
                    </label>
                    <div class="form-text">æ¯ä¸ªèŒƒå›´åªèƒ½æœ‰ä¸€ä¸ªé»˜è®¤æ¨¡æ¿</div>
                </div>

                <button type="submit" class="btn btn-primary" style="width: 100%;">
                    ğŸ’¾ ä¿å­˜æ¨¡æ¿
                </button>
            </form>
        </div>
    </div>

    <!-- å³ä¾§ï¼šæ¨¡æ¿åˆ—è¡¨ -->
    <div class="pref-card">
        <div class="pref-card-header">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <h2 class="pref-card-title">
                    <span>ğŸ“š</span>
                    <span>æˆ‘çš„æ¨¡æ¿</span>
                </h2>
                <span class="badge badge-primary">{{ preferences|length }} / {{ max_templates }}</span>
            </div>
        </div>
        <div class="pref-card-body">
            {% if preferences %}
            <div style="display: flex; flex-direction: column; gap: 1rem;">
                {% for pref in preferences %}
                <div class="template-item">
                    <!-- æ¨¡æ¿å¤´éƒ¨ -->
                    <div class="template-header">
                        <div style="display: flex; align-items: center; gap: 0.75rem;">
                            <div class="template-name">{{ pref.name }}</div>
                            {% if pref.is_default %}
                            <span class="badge badge-success">â­ é»˜è®¤</span>
                            {% endif %}
                        </div>
                        <span class="badge badge-gray">{{ pref.scope.value }}</span>
                    </div>

                    <!-- æç¤ºè¯å†…å®¹ -->
                    <div class="template-content-box">
                        <div class="template-text">{{ pref.prompt_text }}</div>
                    </div>

                    <!-- å…ƒä¿¡æ¯å’Œæ“ä½œ -->
                    <div class="template-footer">
                        <div>{{ pref.prompt_text|length }} / 2000 å­—ç¬¦</div>
                        <form method="post" action="/preferences/{{ pref.id }}/delete" style="margin: 0;">
                            <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªæ¨¡æ¿å—ï¼Ÿ');">
                                ğŸ—‘ï¸ åˆ é™¤
                            </button>
                        </form>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <!-- ç©ºçŠ¶æ€ -->
            <div class="empty-state-pref">
                <div class="empty-icon-pref">ğŸ“</div>
                <div class="empty-title-pref">è¿˜æ²¡æœ‰åˆ›å»ºä»»ä½•æ¨¡æ¿</div>
                <div class="empty-desc-pref">åœ¨å·¦ä¾§è¡¨å•ä¸­åˆ›å»ºæ‚¨çš„ç¬¬ä¸€ä¸ªæç¤ºè¯æ¨¡æ¿</div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- å¸®åŠ©æç¤º -->
<div class="help-box">
    <div class="help-title">
        <span>ğŸ’¡</span>
        <span>ä½¿ç”¨æç¤º</span>
    </div>
    <ul class="help-list">
        <li>æ¯ä¸ªç”¨æˆ·æœ€å¤šå¯ä»¥åˆ›å»º {{ max_templates }} ä¸ªæç¤ºè¯æ¨¡æ¿</li>
        <li>Daily èŒƒå›´çš„æ¨¡æ¿ä½œç”¨äºæ•´ä¸ªæ—¥æŠ¥ç”Ÿæˆè¿‡ç¨‹</li>
        <li>Article èŒƒå›´çš„æ¨¡æ¿ä½œç”¨äºå•ç¯‡æ–‡ç« åˆ†æ</li>
        <li>é»˜è®¤æ¨¡æ¿å°†åœ¨æ²¡æœ‰æŒ‡å®šæ¨¡æ¿æ—¶è‡ªåŠ¨ä½¿ç”¨</li>
        <li>ä¿®æ”¹æ¨¡æ¿ï¼šä½¿ç”¨ç›¸åŒåç§°ä¿å­˜å³å¯è¦†ç›–åŸæ¨¡æ¿</li>
    </ul>
</div>

{% endblock %}
