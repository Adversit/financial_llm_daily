{% extends "base.html" %}

{% block breadcrumb %}ç³»ç»Ÿè®¾ç½®{% endblock %}

{% block content %}
<style>
    /* ç³»ç»Ÿè®¾ç½®é¡µé¢æ ·å¼ */
    .settings-header {
        background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        border-radius: 12px;
        padding: 2rem;
        color: white;
        margin-bottom: 2rem;
        box-shadow: 0 4px 12px rgba(67, 233, 123, 0.2);
    }

    .settings-title {
        font-size: 1.75rem;
        font-weight: 700;
        margin-bottom: 0.5rem;
    }

    .settings-subtitle {
        font-size: 0.9375rem;
        opacity: 0.95;
    }

    .settings-section {
        background: white;
        border-radius: 12px;
        padding: 2rem;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        margin-bottom: 1.5rem;
    }

    .settings-section-title {
        font-size: 1.125rem;
        font-weight: 600;
        color: #0f172a;
        margin-bottom: 1.5rem;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid #e2e8f0;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .setting-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 2rem;
        margin-bottom: 1.5rem;
        align-items: start;
    }

    .setting-item {
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .setting-label {
        font-size: 0.9375rem;
        font-weight: 500;
        color: #334155;
    }

    .setting-desc {
        font-size: 0.8125rem;
        color: #64748b;
        margin-bottom: 0.25rem;
    }

    .setting-input {
        padding: 0.625rem 1rem;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 0.875rem;
        transition: all 0.2s;
    }

    .setting-input:focus {
        outline: none;
        border-color: #2563eb;
        box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
    }

    .color-input-group {
        display: flex;
        gap: 0.75rem;
        align-items: center;
    }

    .color-preview {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        border: 2px solid #e2e8f0;
        cursor: pointer;
    }

    .save-button {
        background: linear-gradient(135deg, #2563eb 0%, #1e4976 100%);
        color: white;
        padding: 0.75rem 2rem;
        border-radius: 8px;
        font-weight: 600;
        border: none;
        cursor: pointer;
        transition: all 0.2s;
        font-size: 0.9375rem;
    }

    .save-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
    }

    @media (max-width: 768px) {
        .setting-row {
            grid-template-columns: 1fr;
            gap: 1.5rem;
        }
    }
</style>

<!-- é¡µé¢å¤´éƒ¨ -->
<div class="settings-header">
    <div class="settings-title">ğŸ”§ ç³»ç»Ÿè®¾ç½®</div>
    <div class="settings-subtitle">é…ç½®ç³»ç»Ÿè¿è¡Œå‚æ•°ã€å±•ç¤ºé€‰é¡¹å’Œæ ·å¼åå¥½</div>
</div>

<form action="/admin/settings" method="post">
<!-- æŠ¥å‘Šç”Ÿæˆè®¾ç½® -->
<div class="settings-section">
    <div class="settings-section-title">
        <span>ğŸ“Š</span>
        <span>æŠ¥å‘Šç”Ÿæˆè®¾ç½®</span>
    </div>

    <div class="setting-row">
        <div class="setting-item">
            <label class="setting-label">æ¯æ—¥æŠ¥å‘Šä¿¡æ¯TopN</label>
            <div class="setting-desc">æ§åˆ¶æ¯æ—¥æŠ¥å‘Šæ˜¾ç¤ºçš„ä¿¡æ¯æ¡ç›®æ•°é‡ä¸Šé™</div>
            <input type="number" name="report_topn" class="setting-input" value="{{ settings.report_topn }}" min="1" max="100" required>
        </div>

        <div class="setting-item">
            <label class="setting-label">ç½®ä¿¡åº¦é˜ˆå€¼</label>
            <div class="setting-desc">è®¾ç½®ä¿¡æ¯ç½®ä¿¡åº¦è¯„åˆ†é˜ˆå€¼ï¼ˆ0-1ï¼‰</div>
            <input type="number" name="confidence_threshold" class="setting-input" value="{{ settings.confidence_threshold }}" min="0" max="1" step="0.01" required>
        </div>
    </div>

    <div class="setting-row">
        <div class="setting-item">
            <label class="setting-label">æœ€å°å†…å®¹é•¿åº¦</label>
            <div class="setting-desc">ä¿¡æ¯å†…å®¹æœ€å°å­—ç¬¦æ•°è¦æ±‚</div>
            <input type="number" name="min_content_len" class="setting-input" value="{{ settings.min_content_len }}" min="50" max="500" required>
        </div>

        <div class="setting-item">
            <label class="setting-label">è¯äº‘ç¼“å­˜æ—¶é•¿ï¼ˆå°æ—¶ï¼‰</label>
            <div class="setting-desc">è¯äº‘å›¾ç‰‡ç¼“å­˜æ—¶é—´ï¼ˆ24å°æ—¶=1å¤©ï¼‰</div>
            <input type="number" name="wordcloud_cache_ttl_hours" class="setting-input" value="{{ settings.wordcloud_cache_ttl_hours }}" min="1" max="168" required>
        </div>
    </div>
</div>

<!-- æ•°æ®é‡‡é›†è®¾ç½® -->
<div class="settings-section">
    <div class="settings-section-title">
        <span>ğŸ“¡</span>
        <span>æ•°æ®é‡‡é›†è®¾ç½®</span>
    </div>

    <div class="setting-row">
        <div class="setting-item">
            <label class="setting-label">RSSå¹¶å‘æ•°</label>
            <div class="setting-desc">RSSæºé‡‡é›†å¹¶å‘æ•°é‡</div>
            <input type="number" name="crawl_concurrency_rss" class="setting-input" value="{{ settings.crawl_concurrency_rss }}" min="1" max="50" required>
        </div>

        <div class="setting-item">
            <label class="setting-label">Webå¹¶å‘æ•°</label>
            <div class="setting-desc">ç½‘é¡µé‡‡é›†å¹¶å‘æ•°é‡</div>
            <input type="number" name="crawl_concurrency_web" class="setting-input" value="{{ settings.crawl_concurrency_web }}" min="1" max="20" required>
        </div>
    </div>

    <div class="setting-row">
        <div class="setting-item">
            <label class="setting-label">LLMè¶…æ—¶æ—¶é—´ï¼ˆç§’ï¼‰</label>
            <div class="setting-desc">LLMè°ƒç”¨è¶…æ—¶æ—¶é—´</div>
            <input type="number" name="llm_timeout_sec" class="setting-input" value="{{ settings.llm_timeout_sec }}" min="30" max="300" required>
        </div>

        <div class="setting-item">
            <label class="setting-label">LLMé‡è¯•æ¬¡æ•°</label>
            <div class="setting-desc">LLMå¤±è´¥åçš„é‡è¯•æ¬¡æ•°</div>
            <input type="number" name="llm_retries" class="setting-input" value="{{ settings.llm_retries }}" min="0" max="5" required>
        </div>
    </div>
</div>

<!-- é‚®ä»¶å‘é€è®¾ç½® -->
<div class="settings-section">
    <div class="settings-section-title">
        <span>ğŸ“§</span>
        <span>é‚®ä»¶å‘é€è®¾ç½®</span>
    </div>

    <div class="setting-row">
        <div class="setting-item">
            <label class="setting-label">SMTPæœåŠ¡å™¨</label>
            <div class="setting-desc">SMTPæœåŠ¡å™¨åœ°å€</div>
            <input type="text" name="smtp_host" class="setting-input" value="{{ settings.smtp_host }}" required>
        </div>

        <div class="setting-item">
            <label class="setting-label">SMTPç«¯å£</label>
            <div class="setting-desc">SMTPæœåŠ¡å™¨ç«¯å£ï¼ˆSSL: 465ï¼‰</div>
            <input type="number" name="smtp_port" class="setting-input" value="{{ settings.smtp_port }}" min="1" max="65535" required>
        </div>
    </div>

    <div class="setting-row">
        <div class="setting-item">
            <label class="setting-label">é‚®ä»¶æ‰¹é‡é™åˆ¶</label>
            <div class="setting-desc">å•æ‰¹æ¬¡æœ€å¤šå‘é€é‚®ä»¶æ•°</div>
            <input type="number" name="mail_batch_limit" class="setting-input" value="{{ settings.mail_batch_limit }}" min="1" max="100" required>
        </div>

        <div class="setting-item">
            <label class="setting-label">å‘é€é€Ÿç‡ï¼ˆå°/ç§’ï¼‰</label>
            <div class="setting-desc">é‚®ä»¶å‘é€é€Ÿç‡é™åˆ¶</div>
            <input type="number" name="mail_rate_limit_per_sec" class="setting-input" value="{{ settings.mail_rate_limit_per_sec }}" min="1" max="10" required>
        </div>
    </div>
</div>

<!-- é¢œè‰²æ ·å¼è®¾ç½® -->
<div class="settings-section">
    <div class="settings-section-title">
        <span>ğŸ¨</span>
        <span>é¢œè‰²æ ·å¼è®¾ç½®</span>
    </div>

    <div class="setting-row">
        <div class="setting-item">
            <label class="setting-label">ä¸»è‰²è°ƒ</label>
            <div class="setting-desc">ç³»ç»Ÿä¸»é¢˜è‰²</div>
            <div class="color-input-group">
                <input type="color" class="color-preview" value="{{ settings.primary_color }}">
                <input type="text" name="primary_color" class="setting-input" value="{{ settings.primary_color }}" style="flex: 1;" pattern="^#[0-9A-Fa-f]{6}$" required>
            </div>
        </div>

        <div class="setting-item">
            <label class="setting-label">æ¬¡è¦è‰²</label>
            <div class="setting-desc">è¾…åŠ©ä¸»é¢˜è‰²</div>
            <div class="color-input-group">
                <input type="color" class="color-preview" value="{{ settings.secondary_color }}">
                <input type="text" name="secondary_color" class="setting-input" value="{{ settings.secondary_color }}" style="flex: 1;" pattern="^#[0-9A-Fa-f]{6}$" required>
            </div>
        </div>
    </div>

    <div class="setting-row">
        <div class="setting-item">
            <label class="setting-label">å¼ºè°ƒè‰²</label>
            <div class="setting-desc">æŒ‰é’®å’Œé‡è¦å…ƒç´ é¢œè‰²</div>
            <div class="color-input-group">
                <input type="color" class="color-preview" value="{{ settings.accent_color }}">
                <input type="text" name="accent_color" class="setting-input" value="{{ settings.accent_color }}" style="flex: 1;" pattern="^#[0-9A-Fa-f]{6}$" required>
            </div>
        </div>

        <div class="setting-item">
            <!-- å ä½ï¼Œä¿æŒå¸ƒå±€ -->
        </div>
    </div>
</div>

<!-- LLM Providerè®¾ç½® -->
<div class="settings-section">
    <div class="settings-section-title">
        <span>ğŸ¤–</span>
        <span>LLM Providerè®¾ç½®</span>
    </div>

    <div class="setting-row">
        <div class="setting-item">
            <label class="setting-label">ä¸»Provider (DeepSeek)</label>
            <div class="setting-desc">ä¸»è¦ä½¿ç”¨çš„LLM Provider</div>
            <input type="text" name="provider_deepseek" class="setting-input" value="{{ settings.provider_deepseek }}" required>
        </div>

        <div class="setting-item">
            <label class="setting-label">å¤‡ç”¨Provider (Qwen)</label>
            <div class="setting-desc">å¤‡ç”¨LLM Provider</div>
            <input type="text" name="provider_qwen" class="setting-input" value="{{ settings.provider_qwen }}" required>
        </div>
    </div>
</div>

<!-- æ“ä½œæŒ‰é’® -->
<div style="display: flex; gap: 1rem; justify-content: flex-end; margin-top: 2rem;">
    <button type="submit" class="save-button">
        ä¿å­˜è®¾ç½®
    </button>
</div>
</form>

<!-- æç¤ºä¿¡æ¯ -->
<div style="background: #fef3c7; border-left: 4px solid #f59e0b; padding: 1rem 1.25rem; border-radius: 8px; margin-top: 2rem;">
    <div style="font-weight: 600; color: #92400e; margin-bottom: 0.5rem; display: flex; align-items: center; gap: 0.5rem;">
        <span>âš ï¸</span>
        <span>æ³¨æ„äº‹é¡¹</span>
    </div>
    <div style="color: #92400e; font-size: 0.875rem;">
        ä¿®æ”¹ç³»ç»Ÿè®¾ç½®å¯èƒ½å½±å“æŠ¥å‘Šç”Ÿæˆå’Œæ•°æ®é‡‡é›†åŠŸèƒ½ï¼Œè¯·è°¨æ…æ“ä½œã€‚è®¾ç½®ä¿å­˜åä¼šåœ¨ä¸‹æ¬¡ä»»åŠ¡è¿è¡Œæ—¶ç”Ÿæ•ˆã€‚
    </div>
</div>

<script>
// é¢œè‰²é€‰æ‹©å™¨åŒæ­¥
document.querySelectorAll('.color-preview').forEach(preview => {
    const input = preview.nextElementSibling;

    preview.addEventListener('change', (e) => {
        input.value = e.target.value;
    });

    input.addEventListener('input', (e) => {
        if (/^#[0-9A-F]{6}$/i.test(e.target.value)) {
            preview.value = e.target.value;
        }
    });
});
</script>

{% endblock %}
