<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}é‡‘èæƒ…æŠ¥æ—¥æŠ¥ç³»ç»Ÿ{% endblock %}</title>
    <link rel="stylesheet" href="{{ url_for('static', path='css/custom.css') }}">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <div class="app-layout">
        <!-- å·¦ä¾§è¾¹æ  -->
        <aside class="sidebar">
            <!-- Logo åŒºåŸŸ -->
            <div class="sidebar-logo">
                <div class="sidebar-logo-icon">F</div>
                <div class="sidebar-logo-text">
                    <div class="sidebar-logo-title">é‡‘èæƒ…æŠ¥æ—¥æŠ¥</div>
                    <div class="sidebar-logo-subtitle">FinIntel Daily</div>
                </div>
            </div>

            <!-- å¯¼èˆªèœå• -->
            <nav class="sidebar-nav">
                <!-- æ ¸å¿ƒåŠŸèƒ½ -->
                <div class="nav-section">
                    <div class="nav-section-title">æ ¸å¿ƒåŠŸèƒ½</div>
                    <a href="/reports" class="nav-item {% if request.url.path.startswith('/reports') %}active{% endif %}">
                        <span class="nav-item-icon">ğŸ“Š</span>
                        <span>æ—¥æŠ¥æµè§ˆ</span>
                    </a>
                    <a href="/stats/wordcloud/view" class="nav-item {% if request.url.path.startswith('/stats') %}active{% endif %}">
                        <span class="nav-item-icon">â˜ï¸</span>
                        <span>æ•°æ®ç»Ÿè®¡</span>
                    </a>
                    <a href="/preferences" class="nav-item {% if request.url.path == '/preferences' %}active{% endif %}">
                        <span class="nav-item-icon">âš™ï¸</span>
                        <span>åå¥½è®¾ç½®</span>
                    </a>
                </div>

                <!-- æ™ºèƒ½æ£€ç´¢ (é¢„ç•™) -->
                <div class="nav-section">
                    <div class="nav-section-title">æ™ºèƒ½æ£€ç´¢</div>
                    <a href="#" class="nav-item" style="cursor: not-allowed; opacity: 0.6;">
                        <span class="nav-item-icon">ğŸ”</span>
                        <span>RAG æ£€ç´¢</span>
                        <span class="nav-item-coming">å³å°†æ¨å‡º</span>
                    </a>
                    <a href="#" class="nav-item" style="cursor: not-allowed; opacity: 0.6;">
                        <span class="nav-item-icon">ğŸš€</span>
                        <span>DeepSearch</span>
                        <span class="nav-item-coming">å³å°†æ¨å‡º</span>
                    </a>
                </div>

                <!-- ç®¡ç†å‘˜åŠŸèƒ½ -->
                {% if current_user and current_user.role.value == 'admin' %}
                <div class="nav-section">
                    <div class="nav-section-title">ç³»ç»Ÿç®¡ç†</div>
                    <a href="/admin" class="nav-item {% if request.url.path == '/admin' %}active{% endif %}">
                        <span class="nav-item-icon">ğŸ </span>
                        <span>ç®¡ç†é¦–é¡µ</span>
                    </a>
                    <a href="/admin/sources" class="nav-item {% if request.url.path.startswith('/admin/sources') %}active{% endif %}">
                        <span class="nav-item-icon">ğŸ“¡</span>
                        <span>ä¿¡æ¯æºç®¡ç†</span>
                    </a>
                    <a href="/admin/recipients" class="nav-item {% if request.url.path.startswith('/admin/recipients') %}active{% endif %}">
                        <span class="nav-item-icon">ğŸ“§</span>
                        <span>æ”¶ä»¶äººç®¡ç†</span>
                    </a>
                    <a href="/admin/settings" class="nav-item {% if request.url.path.startswith('/admin/settings') %}active{% endif %}">
                        <span class="nav-item-icon">ğŸ”§</span>
                        <span>ç³»ç»Ÿè®¾ç½®</span>
                    </a>
                    <a href="/admin/status" class="nav-item {% if request.url.path.startswith('/admin/status') %}active{% endif %}">
                        <span class="nav-item-icon">ğŸ“ˆ</span>
                        <span>ç³»ç»ŸçŠ¶æ€</span>
                    </a>
                    <a href="/admin/usage" class="nav-item {% if request.url.path.startswith('/admin/usage') %}active{% endif %}">
                        <span class="nav-item-icon">ğŸ’°</span>
                        <span>è´¹ç”¨ç»Ÿè®¡</span>
                    </a>
                    <a href="/admin/audit" class="nav-item {% if request.url.path.startswith('/admin/audit') %}active{% endif %}">
                        <span class="nav-item-icon">ğŸ“</span>
                        <span>æ“ä½œå®¡è®¡</span>
                    </a>
                </div>
                {% endif %}
            </nav>

            <!-- ç”¨æˆ·ä¿¡æ¯åŒº -->
            {% if current_user %}
            <div class="sidebar-user">
                <div class="sidebar-user-avatar">
                    {{ current_user.email[0].upper() }}
                </div>
                <div class="sidebar-user-info">
                    <div class="sidebar-user-name">{{ current_user.email }}</div>
                    <div class="sidebar-user-role">
                        {% if current_user.role.value == 'admin' %}ç®¡ç†å‘˜{% else %}ç”¨æˆ·{% endif %}
                    </div>
                </div>
                <form action="/logout" method="post" style="margin: 0;">
                    <button type="submit" style="background: none; border: none; color: rgba(255,255,255,0.7); cursor: pointer; padding: 0.5rem;" title="é€€å‡ºç™»å½•">
                        ğŸšª
                    </button>
                </form>
            </div>
            {% endif %}
        </aside>

        <!-- ä¸»å†…å®¹åŒº -->
        <div class="main-container">
            <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
            <header class="topbar">
                <div class="topbar-breadcrumb">
                    <span>é‡‘èæƒ…æŠ¥æ—¥æŠ¥ç³»ç»Ÿ</span>
                    <span class="breadcrumb-separator">/</span>
                    <span>{% block breadcrumb %}é¦–é¡µ{% endblock %}</span>
                </div>
                <div class="topbar-actions">
                    {% block topbar_actions %}
                    <button class="topbar-action-btn" onclick="window.open('/docs', '_blank')">
                        ğŸ“š APIæ–‡æ¡£
                    </button>
                    <button class="topbar-action-btn" onclick="window.location.href='/healthz'">
                        ğŸ’š å¥åº·æ£€æŸ¥
                    </button>
                    {% endblock %}
                </div>
            </header>

            <!-- é¡µé¢å†…å®¹ -->
            <main class="content-area">
                {% block content %}{% endblock %}
            </main>
        </div>
    </div>

    <script src="{{ url_for('static', path='js/app.js') }}"></script>
    {% block scripts %}{% endblock %}
</body>
</html>
